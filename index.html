<!DOCTYPE html>
<html>
<head>
<title>Interactive 3D Particle System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        margin:0; overflow:hidden;
        background:black; 
        font-family:Arial, sans-serif;
    }
    #ui {
        position:fixed;
        top:20px; right:20px;
        background:rgba(255,255,255,0.12);
        backdrop-filter: blur(10px);
        padding:12px;
        border-radius:10px;
        display:flex;
        flex-direction:column;
        gap:10px;
    }
    select, input, button {
        padding:8px;
        border:none;
        border-radius:6px;
        font-size:14px;
    }
    button {
        cursor:pointer;
        background:#222;
        color:white;
    }
</style>
</head>
<body>

<div id="ui">
    <select id="shapeSelect">
        <option value="Heart3D">Heart</option>
        <option value="Flower">Flower</option>
        <option value="Star">Star</option>
        <option value="Snowflake">Snowflake</option>
        <option value="OrbitRing">Solar Orbit</option>
    </select>

    <input type="color" id="colorPicker" value="#ff3388">
    <button id="gestureToggle">Gesture: OFF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r155/three.min.js"></script>

<script>
let scene, camera, renderer, particles;
let attract = true;
let color = "#ff3388";
let shape = "Heart3D";

init();
animate();

function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    camera = new THREE.PerspectiveCamera(
        65, window.innerWidth/window.innerHeight,0.1,1000);
    camera.position.set(0,0,35);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    createParticles(shape);

    document.getElementById("shapeSelect").addEventListener("change", e=>{
        shape = e.target.value;
        createParticles(shape);
    });

    document.getElementById("colorPicker").addEventListener("input", e=>{
        color = e.target.value;
        particles.material.color.set(color);
    });

    document.getElementById("gestureToggle").addEventListener("click", e=>{
        attract = !attract;
        e.target.textContent = attract ? "Gesture: ON" : "Gesture: OFF";
    });

    window.addEventListener("resize", ()=>{
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
    });
}

function createParticles(type){
    if(particles) scene.remove(particles);

    const count = 1500;
    const positions = new Float32Array(count * 3);

    for(let i=0;i<count;i++){
        const p = generateShape(type);
        positions[i*3] = p.x;
        positions[i*3+1] = p.y;
        positions[i*3+2] = p.z;
    }

    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute(
        "position", new THREE.BufferAttribute(positions,3));

    const material = new THREE.PointsMaterial({
        color:new THREE.Color(color),
        size:0.25
    });

    particles = new THREE.Points(geometry, material);
    scene.add(particles);
}

function generateShape(type){
    const p = new THREE.Vector3();

    switch(type){
        case "Heart3D": {
            const t = Math.random()*Math.PI*2;
            const u = (Math.random()-0.5)*2;
            const r = (2 - Math.abs(u))*(0.8+Math.random()*0.6);
            p.x = r*Math.cos(t);
            p.y = 1.3*Math.pow(Math.sin(t),3);
            p.z = u*1.5;
        } break;

        case "Flower": {
            p.setFromSphericalCoords(
                10+Math.random()*2,
                Math.random()*Math.PI,
                Math.random()*Math.PI*2
            );
        } break;

        case "Star": {
            let radius = 7 + Math.random()*3;
            p.x = (Math.random()-0.5)*radius;
            p.y = (Math.random()-0.5)*radius;
            p.z = (Math.random()-0.5)*radius;
        } break;

        case "Snowflake": {
            p.set(Math.random()*6-3, Math.random()*6-3, Math.random()*6-3);
        } break;

        case "OrbitRing": {
            const angle = Math.random()*Math.PI*2;
            p.x = Math.cos(angle)*(8+Math.random()*4);
            p.y = Math.sin(angle)*(8+Math.random()*4);
            p.z = Math.random()*2 - 1;
        } break;
    }

    return p;
}

function animate(){
    requestAnimationFrame(animate);

    const pos = particles.geometry.attributes.position;

    for(let i=0;i<pos.count;i++){
        const x = pos.getX(i);
        const y = pos.getY(i);
        const z = pos.getZ(i);

        const dir = new THREE.Vector3(x,y,z).normalize();

        if(attract){
            pos.setXYZ(i, x - dir.x*0.03, y - dir.y*0.03, z - dir.z*0.03);
        } else {
            pos.setXYZ(i, x + dir.x*0.03, y + dir.y*0.03, z + dir.z*0.03);
        }
    }

    pos.needsUpdate = true;
    particles.rotation.y += 0.002;
    renderer.render(scene, camera);
}
</script>

</body>
</html>
